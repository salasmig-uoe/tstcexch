<?xml version="1.0" encoding="UTF-8"?>
<proxy name="card_cardexchange_idmwrite_proxy" startOnLoad="true" transports="http https" xmlns="http://ws.apache.org/ns/synapse">
    <target>
        <inSequence>
            <property expression="json-eval($)" name="origPayload" scope="default" type="STRING"/>
            <property expression="get-property('env','IDM_WRITE_ENDPOINT')" name="uri.var.idmWriteEndpoint" scope="default" type="STRING"/>
            <log level="full"/>
            <payloadFactory media-type="json">
                <format>$1</format>
                <args>
                    <arg evaluator="xml" expression="get-property('origPayload')"/>
                </args>
            </payloadFactory>
            <log level="custom">
                <property expression="json-eval($)" name="LOG-PROXY-ERROR-QUEUE-BODY"/>
            </log>
            <!-- Sending original message to the error message store -->
            <store messageStore="card_cardexchange_idmwrite_mq_error"/>
            <!-- Acknowledging storage operation completion -->
            <property description="Generate 202 response from mediation flow" name="FORCE_SC_ACCEPTED" scope="axis2" type="STRING" value="true"/>
            <property name="HTTP_SC" scope="axis2" type="STRING" value="202"/>
            <!-- RESPOND with a Successful code indicate the message was accepted and processed or sent to an error queue for later processing -->
            <respond/>
        </inSequence>
        <outSequence/>
        <faultSequence>
            <respond/>
        </faultSequence>
    </target>
</proxy>
